---
lab:
    title: '实验室：使用逻辑应用自动执行业务流程'
    module: '模块 09：开发应用服务逻辑应用'
    type: '答案'
---
    
# 实验室: 使用逻辑应用自动执行业务流程
# 学生实验室答案密钥

## Microsoft Azure 用户界面

鉴于 Microsoft 云工具的动态特性，Azure UI 在此培训内容开发后可能会发生更改。这些更改可能会导致实验室说明和实验室步骤不匹配。

当社区要求我们进行更改时，Microsoft 将更新此培训课程。但是，由于云更新频繁发生，因此在此培训内容更新之前，你可能会遇到 UI 更改情况。 **如果发生这种情况，请适应这些更改，并根据需要在实验中熟悉这些更改。**

## 说明

### 开始前

#### 登录实验室虚拟机

使用以下凭据登录到 Windows 10 虚拟机 (VM)：
    
-   用户名： **管理员**

-   密码： **Pa55w.rd**

> **注意**：你的讲师将提供连接到虚拟实验室环境的说明。

#### 评价已安装的应用程序

在你的 Windows 10 桌面上找到任务栏。任务栏里有本实验室中你将使用的应用程序的图标：
    
-   Microsoft Edge

-   文件资源管理器

-   Windows 终端

### 练习 1 ：创建 Azure 资源

#### 任务 1：打开 Azure 门户

1.  在任务栏上，选择 **“Microsoft Edge”** 图标。

1.  在打开的浏览器窗口中，转到 Azure 门户 (<https://portal.azure.com>)。

1.  输入你的 Microsoft 帐户的电子邮件地址，然后选择 **“下一个”**。

1.  输入你的 Microsoft 帐户的密码，然后选择 **“登录”**。

    > **注意**：第一次登录 Azure 门户时，你会看到一个门户教程。选择 **“开始使用”**，跳过教程。

#### 任务 2：创建 API 管理资源

1.  在 Azure 门户的导航窗格上，选择 **“创建资源”**。

1.  来自 **新** 边栏选项卡，找到 **搜索市场** 文本框。

1.  在搜索框中，输入 **“API”**，然后按 Enter 键。

1.  在 **“市场”** 搜索结果边栏选项卡中，选择 **“API 管理”** 结果。

1.  在 **“API 管理”** 边栏选项卡中，选择 **“创建”**。

1.  在 **“API 管理服务”** 边栏选项卡中，执行以下操作：
    
    1.  在 **“名称”** 文本框中，输入 **prodapim*[yourname]***。
    
    1.  将 **“订阅”** 文本框设置为默认值。
    
    1.  在 **“资源组”** 部分，选择 **“新建”**，在文本框中输入 **“AutomatedWorkflow”**，然后选择 **“确定”**。
    
    1.  在 **“位置”** 列表中，选择 **“美国东部”**。
    
    1.  在 **“组织名称”** 文本框中，输入 **“Contoso”**。
    
    1.  将 **“管理员电子邮件”** 文本框保留设置为默认值。
    
    1.  在 **“定价层”** 列表中，选择 **“消耗 (99.9 SLA, %)”**，然后选择 **“创建”**。
    
    > **注意**：等待 Azure 完成 API 管理资源的创建，再继续本实验室内容。资源创建时你会收到通知。

#### 任务 3：创建逻辑应用资源

1.  在 Azure 门户的导航窗格中，选择 **“+ 创建资源”**。

1.  在 **“新建”** 边栏选项卡中，找到 **“搜索市场”** 字段。

1.  在搜索字段中，输入 **“Logic”**，然后选择 **“Enter”**。

1.  在 **“全部内容”** 搜索结果边栏选项卡中，选择 **“逻辑应用”**。

1.  在 **“逻辑应用”** 边栏选项卡中，选择 **“创建”**。

1.  在 **“逻辑应用”** 栏选项卡中，查看边栏选项卡上的各选项卡，例如 **“基本”**、 **“标记”** 和 **“查看 + 创建”**。

    > **注意**：每个标签页都代表在工作流中新建“逻辑应用”的一个步骤。你可以随时选择 **“查看 + 创建”** 余选项卡。

1.  选择 **“基本”** 选项卡，然后在选项卡区域内执行以下操作：
       
    1.  保留 **“订阅”** 字段设置为默认值。
    
    1.  在 **“资源组”** 列表中，选择 **“使用现有”**，然后选择你之前在本实验室中创建的 **“AutomatedWorkflow”** 组。
        
    1.  在 **“逻辑应用名称”** 字段中，输入 **prodflow*[yourname]***。

    1.  在 **“选择位置”** 部分中，选择 **“区域”**。

    1.  在 **“位置”** 列表中，选择 **“美国东部”**。
    
    1.  在 **“日志分析”** 部分，选择 **“关”**。
    
    1.  选择 **“审阅 + 创建”**。

1.  在 **“查看 + 创建”** 选项卡中，查看在之前步骤中指定的选项。

1.  选择 **“创建”** 以使用指定的配置创建逻辑应用。

    > **注意**：等待 Azure 完成创建逻辑应用资源，再继续本实验室内容。资源创建时你会收到通知。

#### 任务 4：创建存储帐户

1.  在 Azure 门户导航窗格中，选择 **“所有服务”**。

1.  在 **“所有服务”** 边栏选项卡中，选择 **“存储帐户”**。

1.  在 **“存储帐户”** 边栏选项卡中，获取存储帐户实例列表，然后选择 **“添加”**。

1.  在 **“创建存储帐户”** 边栏选项卡中，观察边栏选项卡中的选项卡，如 **“基本信息”**、 **“标记”** 和 **“查看 + 创建”**。

    > **注意**：每个标签页代表工作流中创建新存储帐户的一个步骤。你可以随时选择 **“查看 + 创建”** 跳过其余选项卡。

1.  选择 **“基本”** 选项卡，然后在选项卡区域内执行以下操作：
    
    1.  将 **“订阅”** 文本框保留设置为默认值。
    
    1.  在 **“资源组”** 部分中，选择你之前在本实验室中创建的 **“AutomatedWorkflow”** 组。
    
    1.  在 **“存储帐户名称”** 文本框中，输入 **“prodstor*[yourname]***”**。
    
    1.  在 **“位置”** 列表中，选择 **“（美国）美国东部”** 区域。
    
    1.  在 **“性能”** 部分，选择 **“标准”**。
    
    1.  在 **“帐户类型”** 列表中，选择 **“StorageV2 (常规用途 v2)”**。
    
    1.  在 **“复制”** 列表中，选择 **“本地冗余存储 (LRS)”**。
    
    1.  在 **“访问层(默认)”** 部分，确保 **“热”** 已选中。
    
    1.  选择 **“查看 + 创建”**。

1.  在 **“查看 + 创建”** 选项卡中，查看在之前步骤中指定的选项。

1.  选择 **“创建”**，使用指定的配置创建存储帐户。

    > **注意**：在 **“部署”** 边栏选项卡中，等待创建任务完成后再继续本实验室。

#### 任务 5：将示例内容上传到 Azure 文件

1.  在 Azure 门户导航窗格中，选择 **“资源组”** 链接。

1.  在 **“资源组”** 边栏选项卡中，找到并选择你之前在本实验室中创建的 **“AutomatedWorkflow”** 资源组。

1.  在 **“AutomatedWorkflow”** 边栏选项卡中，选择你之前在本实验室中创建的 **prodstor*[yourname]*** 存储帐户。

1.  在 **“存储帐户”** 边栏选项卡上，在 **“文件服务”** 部分，选择 **“文件共享”** 链接。

1.  在 **“文件共享”** 部分，选择 **“+ 文件共享”**。

1.  在 **“文件共享”** 弹出窗口中，执行以下操作：
    
    1.  在 **“名称”** 文本框中，输入 **“元数据”**。
    
    1.  在 **“配额”** 文本框中，输入 **“1”** (GiB)。
    
    1.  选择 **“创建”**。

1.  返回 **“文件共享”** 部分，选择新创建的 **“元数据”** 共享。

1.	在 **“文件共享”** 边栏选项卡中，选择 **“上传”**。

1.	在 **“上传文件”** 对话框中，执行以下操作：

    1.  在 **“文件”** 部分，选择 **“文件夹”** 图标。

    1.  在 **“文件资源管理器”** 窗口中， **“Allfiles (F):\\Allfiles\\Labs\\09\\Starter”**，选择以下文件，然后选择 **“打开”**：

        -   **item_00.json**
        
        -   **item_01.json**
        
        -   **item_02.json**
        
        -   **item_03.json**
        
        -   **item_04.json** 

    1.  确保选中 **“如果文件存储已经存在，则覆盖”** 复选框，然后选择 **“上传”**。 
    
    > **注意**：等待 blob 上传完成，然后再继续本实验室。

#### 回顾

在本练习中，你创建了本实验室所需的所有资源。

### 练习 2：使用逻辑应用实现工作流

#### 任务 1：创建工作流触发器

1.  在 Azure 门户导航窗格中，选择 **“资源组”**。

1.  在 **“资源组”** 边栏选项卡中，选择你之前在本实验室中创建的 **“AutomatedWorkflow”** 资源组。

1.  在 **“AutomatedWorkflow”** 边栏选项卡中，选择你之前在本实验室中创建的 **prodflow*[yourname]*** 逻辑应用。

1.  在 **“逻辑应用设计器”** 边栏选项卡中，选择 **“空白逻辑应用”** 模板。

1.  在 **“设计器”** 区域，执行以下操作以添加 **“收到 HTTP 请求时（请求）”** 触发器：
    
    1.  在 **“搜索连接器和触发器”** 字段，输入 **“HTTP”**。
    
    1.  在类别列表中，选择 **“请求”**。
    
    1.  在 **“触发器”** 结果列表中，选择 **“收到 HTTP 请求时”**。

1.  在 **收到 HTTP 请求时** 区域，执行以下操作来配置 **收到 HTTP 请求时（请求）** 触发器：
    
    1.  在 **“添加新参数”** 列表中，选择 **“方法”**。

    1.  在 **“方法”** 列表中，选择 **“GET”**。

#### 任务 2：创建一个查询 Azure 存储文件共享的操作

1.  在 **“设计器”** 区域，选择 **“+ 新步骤”**，然后执行以下操作以添加一个 **“列出文件（Azure 文件存储）”** 操作：
    
    1.  在 **“搜索连接器和触发器”** 字段，输入 **“文件”**。
    
    1.  在类别列表中，选择 **“Azure 文件存储”**。
    
    1.  在 **“操作”** 结果列表中，选择 **“列出文件”**。
    
    1.  在 **“连接名称”** 字段中，输入 **“filesConnection”**。
    
    1.  在 **“存储帐户”** 部分，选择之前在本实验室中创建的 **prodstor*[yourname]*** 存储帐户，然后选择 **“创建”**。
    
    1.  等待连接器资源完成创建。

        > **备注**：这些资源需要一到五分钟才能创建完成。

1.  在 **“列出文件”** 区域的 **“文件夹”** 文本框，输入 **“/metadata”**。
    
#### 任务 3：创建一个投射列表项属性的操作

1.  在 **“设计器”** 区域，选择 **“+ 新建步骤”**。

1.  在 **“设计器”** 区域，执行以下操作以添加 **“选择（数据操作）”** 操作：
    
    1.  在 **“搜索连接器和触发器”** 字段中，输入 **“select”**。
    
    1.  在类别列表中，选择 **“数据操作”**。
    
    1.  在 **“操作”** 结果列表中，选择 **“选择”**。

1.  在 **“选择”** 区域，执行以下操作来配置 **“选择(数据操作)”** 操作：
    
    1.  在 **“列出文件”** 类别内 **“动态内容”** 列表中的 **“来自”** 字段中，选择 **“值”**。 
    
    1.  在 **“映射”** 字段中，选择 **“切换至文本模式”**。

    1.  在 **“列出文件”** 类别内 **“动态内容”** 列表中的 **“映射”** 字段中，选择 **“名称”**。
    
#### 任务 4：生成 HTTP 响应操作

1.  在 **“设计器”** 区域，选择 **“+ 新步骤”**，然后执行以下操作以添加一个 **“响应(请求)”** 操作：
 
    1.  在 **“搜索连接器和触发器”** 字段，输入 **“response”**。
       
    1.  在 **“操作”** 结果列表中，选择 **“响应”**。

1.  在 **“响应”** 区域，执行以下操作以配置 **“响应(请求)”** 操作：

    1.  在 **“状态代码”** 文本框中，输入 **“200”**。

    1.  在 **“输出”** 类别内 **“动态内容”** 列表的 **“正文”** 字段中，选择 **“选择”**。

1.  在 **“设计器”** 区域，选择 **“保存”**。

#### 回顾

在本练习中，生成了一个基本工作流，该工作流在由 HTTP GET 请求触发时开始。然后它会查询存储服务，枚举结果，最后将这些结果作为 HTTP 响应返回。

### 练习 3：使用 Azure API 管理作为逻辑应用的代理

#### 任务 1：创建新产品

1.  在 Azure 门户导航窗格中，选择 **“资源组”**。

1.  在 **“资源组”** 边栏选项卡中，选择你之前在本实验室中创建的 **“AutomatedWorkflow”** 资源组。

1.  在 **“AutomatedWorkflow”** 边栏选项卡中，选择你在本实验室前面部分创建的 **prodapim*[yourname]*** API 管理资源。

1.  在 **“API 管理”** 部分的 **“API 管理服务”** 边栏选项卡中，选择 **“产品”**。

1.  在 **“产品”** 部分，选择 **“+ 添加”**。

1.  在 **“添加产品”** 对话框中，执行以下操作：

    1.  在 **“显示名称”** 文本框中，输入 **“免费”**。

    1.  在 **“Id”** 文本框中，输入 **“free”**。

    1.  在 **“描述”** 文本框中，输入 **“供匿名使用免费层”**。

    1.  在 **“状态”** 部分，选择 **“已发布”**。

    1.  确保清除选择 **“需要订阅”** 复选框。

    1.  选择 **“创建”**。

#### 任务 2：创建与逻辑应用集成的 API

1.  在 **“API 管理服务”** 边栏选项卡中，在 **“API 管理”** 部分，选择 **“API”**。

1.  在 **“添加新的 API”** 部分中选择 **“逻辑应用”**。

1.  在 **“从逻辑应用创建”** 对话框中，执行以下操作：

    1.  选择 **“完全”**。

    1.  在 **“逻辑应用”** 部分中，选择 **“浏览”**。 
    
    1.  在 **“选择要导入的逻辑应用”** 对话框中，选择你之前在本实验中创建的 **prodflow*[yourname]*** 逻辑应用，然后选择 **“选择”**。
    
    1.  在 **“显示名称”** 文本框中，输入 **“元数据查找”**。
    
    1.  在 **“名称”** 文本框中，输入 **“元数据查找”**。

    1.  在 **“描述”** 文本框中，输入 **“查找元数据 JSON 文件”**。

    1.  将 **“API URL 后缀”** 文本框留空。

    1.  在 **“产品”** 列表中，选择 **“免费”**。

    1.  选择 **“创建”**。 

    > **注意**：等待新 API 完成创建。

#### 任务 3：测试 API 操作

1.  在 **“设计”** 选项卡中，选择 **“测试”**。

1.  在 **“测试”** 选项卡上，执行以下操作：

    1.  选择单个 **GET** 操作。

    1.  复制 **“请求 URL”** 字段的值。（稍后将在实验室中使用此值。）

    1.  选择 **“发送”**。

    1.  在 **“HTTP 响应”** 部分，观察测试请求的 JSON 结果。

#### 任务 4：使用 httprepl 验证端到端解决方案

1.  在任务栏上，选择 **Windows Terminal** 图标。

1.  在打开的命令提示符处，输入以下命令，然后按 Enter 以启动 **“httprepl”** 工具，将基 URI设置为之前你在本实验复制的用于 API 操作的 **“请求 URL”** 的值。

    ```
    httprepl <api-operation-request-url>
    ```

    > **注意**：例如，如果 **URL** 是 **https://prodapimstudent.azure-api.net/manual/paths/invoke** ，则命令将是 **httprepl https://prodapimstudent.azure-api.net/manual/paths/invoke** 。

1.  在工具提示中，输入以下命令，然后按 Enter，针对 API 终结点运行 **get** 命令：

    ```
    get
    ```

1.  从函数应用观察 JSON 响应内容，该内容现在应包括：

    ```
    [ 
        "item_00.json",
        "item_01.json",
        "item_02.json",
        "item_03.json",
        "item_04.json"
    ]
    ```

1.  输入以下命令，然后按 Enter 退出 **“httprepl”** 应用程序：

    ```
    exit
    ```

1.  关闭当前正在运行的 Windows Terminal 应用程序。

1.	从 Azure 门户返回浏览器窗口。

#### 回顾

在本练习中，将 Azure API 管理用作代理触发了逻辑应用工作流。

### 练习 4：清理订阅 

#### 任务 1：打开 Azure Cloud Shell 并列出资源组

1.  在 Azure 门户中，选择 **“Cloud Shell”** 图标以打开一个新的 shell 实例。

1.  在 Azure 门户的 **“Cloud Shell”** 命令提示符下，输入以下命令并按 Enter，列出订阅中的所有资源组：

    ```
    az group list
    ```

1.  输入以下命令，然后按下 Enter 键，查看用于删除资源组的可用命令列表：

    ```
    az group delete --help
    ```

#### 任务 2：删除资源组

1.  输入以下命令，然后按下 Enter 键以删除 **AutomatedWorkflow** 资源组：

    ```
    az group delete --name AutomatedWorkflow --no-wait --yes
    ```

1.  关闭 Cloud Shell 窗格。

#### 任务 3：关闭活动应用程序

-   关闭当前正在运行的 Microsoft Edge 应用程序。

#### 回顾

在本练习中，你通过删除本实验室中使用的资源组清理订阅。